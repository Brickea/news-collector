<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“– çŸ¥è¯†å›¾è°± Â· 2026-02-26</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #0f1117;
      color: #e6e6ef;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      padding: 0.7rem 1.2rem;
      background: #1a1d2e;
      border-bottom: 1px solid #2d3154;
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-shrink: 0;
      flex-wrap: wrap;
    }
    header h1 { font-size: 1.05rem; font-weight: 600; color: #a8b4ff; }
    header p  { font-size: 0.78rem; color: #8890b0; }
    .header-links { display: flex; gap: 0.6rem; margin-left: auto; flex-wrap: wrap; }
    .header-links a {
      font-size: 0.75rem;
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      text-decoration: none;
      color: #fff;
      white-space: nowrap;
    }
    .btn-home  { background: #667eea; }
    .btn-notes { background: #764ba2; }

    /* â”€â”€ Main layout â”€â”€ */
    main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* â”€â”€ Graph area â”€â”€ */
    #graph-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }
    svg { width: 100%; height: 100%; display: block; }

    /* â”€â”€ Legend â”€â”€ */
    #legend {
      width: 200px;
      flex-shrink: 0;
      background: #1a1d2e;
      border-left: 1px solid #2d3154;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    #legend h3 { font-size: 0.8rem; color: #8890b0; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.4rem; }
    .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.78rem; color: #c0c8e0; cursor: pointer; padding: 0.2rem 0; border-radius: 3px; transition: background 0.15s; }
    .legend-item:hover { background: #252840; }
    .legend-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    #legend hr { border: none; border-top: 1px solid #2d3154; margin: 0.4rem 0; }
    #legend .hint { font-size: 0.7rem; color: #606880; line-height: 1.5; }

    /* â”€â”€ Tooltip â”€â”€ */
    #tooltip {
      position: fixed;
      pointer-events: none;
      background: #1e2236;
      border: 1px solid #3a4070;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      max-width: 280px;
      font-size: 0.78rem;
      line-height: 1.55;
      color: #d0d8f0;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
      display: none;
      z-index: 100;
    }
    #tooltip .tt-title { font-weight: 600; color: #a8b4ff; margin-bottom: 0.35rem; font-size: 0.82rem; }
    #tooltip .tt-type  { font-size: 0.7rem; color: #6070a0; margin-bottom: 0.4rem; }
    #tooltip .tt-desc  { color: #b0bcd0; }
    #tooltip .tt-link  { margin-top: 0.4rem; font-size: 0.7rem; color: #667eea; }

    /* â”€â”€ Node styles (set via JS fill) â”€â”€ */
    .node circle { stroke: #0f1117; stroke-width: 2px; cursor: pointer; transition: filter 0.15s; }
    .node circle:hover { filter: brightness(1.35) drop-shadow(0 0 6px currentColor); }
    .node text { pointer-events: none; fill: #d8e0f8; text-anchor: middle; dominant-baseline: central; }

    /* â”€â”€ Link styles â”€â”€ */
    .link { stroke: #3a4070; stroke-opacity: 0.55; fill: none; }
    .link.cross { stroke: #8890b0; stroke-opacity: 0.35; stroke-dasharray: 4 3; }

    /* Controls */
    #controls {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      display: flex;
      gap: 0.4rem;
    }
    #controls button {
      background: #1e2236;
      border: 1px solid #3a4070;
      color: #a8b4ff;
      border-radius: 4px;
      padding: 0.3rem 0.7rem;
      font-size: 0.78rem;
      cursor: pointer;
      transition: background 0.15s;
    }
    #controls button:hover { background: #2d3154; }

    /* â”€â”€ Mobile responsive â”€â”€ */
    @media (max-width: 600px) {
      header {
        padding: 0.45rem 0.75rem;
        gap: 0.5rem;
      }
      header h1 { font-size: 0.9rem; }
      header p  { display: none; }
      .header-links a {
        font-size: 0.7rem;
        padding: 0.25rem 0.55rem;
      }
      main {
        flex-direction: column-reverse;
      }
      #legend {
        width: 100%;
        max-height: 28vh;
        border-left: none;
        border-top: 1px solid #2d3154;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.3rem;
        padding: 0.5rem 0.75rem;
      }
      #legend h3 { width: 100%; margin-bottom: 0.1rem; }
      #legend hr { display: none; }
      #legend .hint { display: none; }
      .legend-item { font-size: 0.72rem; padding: 0.15rem 0.4rem; }
      #controls {
        bottom: 0.5rem;
        left: 0.5rem;
      }
      #controls button {
        padding: 0.25rem 0.55rem;
        font-size: 0.72rem;
      }
      #tooltip { max-width: min(260px, 85vw); font-size: 0.74rem; }
    }
  </style>
</head>
<body>

<header>
  <div>
    <h1>ğŸ“– çŸ¥è¯†å›¾è°± Â· 2026-02-26</h1>
    <p>ä»Šæ—¥æ–°é—»é˜…è¯» â€” æ·±åº¦çŸ¥è¯†å›¾è°±ï¼ˆäº¤äº’å¼ç½‘ç»œè§†å›¾ï¼‰</p>
  </div>
  <div class="header-links">
    <a class="btn-home"  href="/news-collector/">â† é¦–é¡µ</a>
    <a class="btn-notes" href="2026-02-26-reading-notes.html">ğŸ“„ æ–‡å­—ç‰ˆ</a>
  </div>
</header>

<main>
  <div id="graph-container">
    <svg id="graph"></svg>
    <div id="tooltip"></div>
    <div id="controls">
      <button id="btn-reset">é‡ç½®è§†å›¾</button>
      <button id="btn-freeze">æš‚åœå¸ƒå±€</button>
    </div>
  </div>

  <nav id="legend">
    <h3>ä¸»é¢˜èŠ‚ç‚¹</h3>
    <!-- populated by JS -->
    <hr/>
    <p class="hint">
      ğŸ–± æ‹–åŠ¨èŠ‚ç‚¹<br/>
      ğŸ” æ»šè½®ç¼©æ”¾<br/>
      ğŸ‘† ç‚¹å‡»æ‰“å¼€é“¾æ¥<br/>
      ğŸ· æ‚¬åœæŸ¥çœ‹æè¿°
    </p>
    <hr/>
    <h3>è¿çº¿ç±»å‹</h3>
    <div class="legend-item"><svg width="28" height="10"><line x1="0" y1="5" x2="28" y2="5" stroke="#3a4070" stroke-width="2"/></svg> ä»å±å…³ç³»</div>
    <div class="legend-item"><svg width="28" height="10"><line x1="0" y1="5" x2="28" y2="5" stroke="#8890b0" stroke-width="1.5" stroke-dasharray="4 3"/></svg> æ¨ªåˆ‡å…³è”</div>
  </nav>
</main>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CATEGORIES = [
  { id: "root",     label: "2026-02-26\né˜…è¯»ä¼šè¯",         color: "#ffffff", size: 28, group: 0 },
  { id: "cat-ai",   label: "ğŸ¤– Agentic AI\næŠ€æœ¯ç”Ÿæ€",       color: "#667eea", size: 22, group: 1 },
  { id: "cat-sec",  label: "ğŸ”’ Agent\nå®‰å…¨ä¸è®°å¿†",          color: "#f5a623", size: 22, group: 2 },
  { id: "cat-eng",  label: "ğŸ›  è½¯ä»¶å·¥ç¨‹\nCI/CD",            color: "#43e97b", size: 22, group: 3 },
  { id: "cat-biz",  label: "ğŸ’¼ è¡Œä¸šå†²å‡»\nå•†ä¸šæ¨¡å¼",          color: "#fa709a", size: 22, group: 4 },
  { id: "cat-proj", label: "ğŸ§‘â€ğŸ’» ä¸ªäººé¡¹ç›®\nå­¦ä¹ è½¨è¿¹",          color: "#4facfe", size: 22, group: 5 },
  { id: "cat-deep", label: "ğŸ”­ æ·±åº¦æ—æ”¯\nå­¦æœ¯è¶£å‘³",          color: "#a29bfe", size: 22, group: 6 },
];

const ARTICLES = [
  // â”€â”€ Agentic AI â”€â”€
  { id: "cowork",    cat: "cat-ai",   label: "Anthropic\nCowork",       url: "https://venturebeat.com/technology/anthropic-launches-cowork-a-claude-desktop-agent-that-works-in-your-files-no", desc: "æ¡Œé¢çº§ Agentï¼Œå¯åœ¨æœ¬åœ°æ–‡ä»¶ä¸å·¥ä½œæµä¸­æ‰§è¡Œä»»åŠ¡ï¼Œé™ä½ä¸Šæ‰‹é—¨æ§›ï¼Œä»£è¡¨ Agent å‘éå·¥ç¨‹ç”¨æˆ·æ‰©å±•çš„è¶‹åŠ¿ã€‚" },
  { id: "sysprompt", cat: "cat-ai",   label: "System Prompts\nCollection", url: "https://github.com/x1xhlol/system-prompts-and-models-of-ai-tools/tree/main", desc: "æ±‡æ€»å¤šå®¶å·¥å…·ä¸å†…éƒ¨ç³»ç»Ÿæç¤ºçš„ä»“åº“ï¼Œé€‚åˆåš prompt-engineering å‚è€ƒä¸å¯¹æ¯”æµ‹è¯•ã€‚" },
  { id: "ctx-mode",  cat: "cat-ai",   label: "Claude\nContext Mode",    url: "https://github.com/mksglu/claude-context-mode", desc: "è§£å†³å¤§è¾“å‡ºå¯¼è‡´ä¸Šä¸‹æ–‡ä¸¢å¤±çš„å·¥å…·ï¼Œæç¤ºé•¿å¯¹è¯æˆ–å¤§æ–‡æ¡£å¤„ç†çš„å·¥ç¨‹å®è·µã€‚" },
  { id: "cost-cmp",  cat: "cat-ai",   label: "Claude Code\nvs æ›¿ä»£å“",   url: "https://brickea.github.io/news-collector/archive/2026/02/2026-02-25.html", desc: "å¸‚åœºä¸Šå­˜åœ¨ä»˜è´¹ä¸å…è´¹æ›¿ä»£æ–¹æ¡ˆï¼Œå½±å“ä¼ä¸šéƒ¨ç½²å†³ç­–ä¸ TCO è¯„ä¼°ã€‚" },

  // â”€â”€ Security & Memory â”€â”€
  { id: "clawmoat",  cat: "cat-sec",  label: "ClawMoat",                url: "https://dev.to/darbogach/clawmoat-vs-llamafirewall-vs-nemo-guardrails-which-open-source-ai-agent-security-tool-should-you-128h", desc: "ä¸»æœºçº§ç›‘æ§ç­–ç•¥ï¼Œé€‚åˆåœ¨ Agent éƒ¨ç½²å‰åšå¨èƒå»ºæ¨¡ã€‚" },
  { id: "llamafw",   cat: "cat-sec",  label: "LlamaFirewall",           url: "https://dev.to/darbogach/clawmoat-vs-llamafirewall-vs-nemo-guardrails-which-open-source-ai-agent-security-tool-should-you-128h", desc: "æ³¨å…¥æ£€æµ‹é˜²æŠ¤ç­–ç•¥ï¼Œæ£€æµ‹ prompt injection æ”»å‡»ã€‚" },
  { id: "nemo",      cat: "cat-sec",  label: "NeMo\nGuardrails",        url: "https://dev.to/darbogach/clawmoat-vs-llamafirewall-vs-nemo-guardrails-which-open-source-ai-agent-security-tool-should-you-128h", desc: "å¯¹è¯çº§çº¦æŸ DSLï¼Œç”¨å£°æ˜å¼è§„åˆ™çº¦æŸ LLM è¡Œä¸ºè¾¹ç•Œã€‚" },
  { id: "mem-arch",  cat: "cat-sec",  label: "AI Agent\nMemory æ¶æ„",   url: "https://dev.to/oblivionlabz/building-ai-agent-memory-architecture-a-deep-dive-into-llm-state-management-for-power-users-h8m", desc: "å°†è®°å¿†åˆ†ä¸º Working / Episodic / Semantic / Procedural å››å±‚ï¼Œå¯¹é•¿æœŸä»»åŠ¡ Agent è®¾è®¡æœ‰ç›´æ¥æŒ‡å¯¼æ„ä¹‰ã€‚" },

  // â”€â”€ Engineering â”€â”€
  { id: "actions-tc",cat: "cat-eng",  label: "GitHub Actions\nå›¾çµå®Œå¤‡æ€§", url: "https://github.com/Brickea/interesting-thought/blob/main/ideas/tech-insights/001-github-actions-turing-completeness.md", desc: "å±•ç¤º Actions å¯è¢«ç”¨ä½œå¤æ‚æ§åˆ¶æµä¸è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œéœ€æ³¨æ„å¯ç»´æŠ¤æ€§ä¸å®‰å…¨è¾¹ç•Œã€‚" },
  { id: "workflow",  cat: "cat-eng",  label: "daily-program\nWorkflow Runs", url: "https://github.com/Brickea/daily-program/actions", desc: "é¡¹ç›®æµæ°´çº¿è¿è¡Œè®°å½•ï¼Œå¯ä½œä¸ºéªŒè¯ Agent é›†æˆæ•ˆæœçš„ç¬¬ä¸€æ‰‹æ•°æ®ã€‚" },
  { id: "copilot",   cat: "cat-eng",  label: "GitHub Copilot\nå·¥å…·é›†æˆ", url: "https://github.com/copilot/c/05f637e8-6cea-43a0-bf0b-c76bf2fe4d90", desc: "å…³æ³¨ Copilot ä¸å¤–éƒ¨å·¥å…·äº¤äº’ã€OAuth ä¸ token åˆ·æ–°æµç¨‹ï¼Œæœ€å°æƒé™ç­–ç•¥ã€‚" },
  { id: "websocket", cat: "cat-eng",  label: "WebSocket\nè°ƒè¯•æ¡ˆä¾‹",      url: "https://dev.to/combba/the-websocket-cascade-from-hell-3o1a", desc: "å®æˆ˜æ•…éšœæ’æŸ¥ä¸æ¶æ„é€‰æ‹©ç»éªŒï¼Œæ–­çº¿é‡è¿ä¸ç†”æ–­æœºåˆ¶çš„ SRE å¤ç›˜ã€‚" },

  // â”€â”€ Industry & Business â”€â”€
  { id: "cobol",     cat: "cat-biz",  label: "COBOL ç°ä»£åŒ–\nÃ— AI",       url: "https://www.artificialintelligence-news.com/news/cobol-modernization-ai-claude-ibm", desc: "Agent/LLM èƒ½æ˜¾è‘—åŠ é€Ÿé—ç•™ç³»ç»Ÿç°ä»£åŒ–ï¼Œå¸¦æ¥çŸ­æœŸå¸‚åœºæ³¢åŠ¨ï¼Œå½±å“ä¼ ç»Ÿä¾›åº”å•†ã€‚" },
  { id: "ag-fin",    cat: "cat-biz",  label: "Agentic\nFinance ROI",     url: "https://www.artificialintelligence-news.com/news/deploying-agentic-finance-ai-for-immediate-business-roi", desc: "é‡‘èè¡Œä¸šè¯•ç‚¹å¯å®¡è®¡ Agent æµç¨‹ï¼Œå…³æ³¨åˆè§„ä¸å®¡è®¡é“¾è·¯è®¾è®¡ã€‚" },
  { id: "crawl",     cat: "cat-biz",  label: "Pay-Per-Crawl\nå•†ä¸šæ¨¡å¼",   url: "https://stackoverflow.blog/2026/02/19/stack-overflow-cloudflare-pay-per-crawl", desc: "Stack Overflow Ã— Cloudflare å±•ç¤ºå†…å®¹æä¾›æ–¹ä¸åŸºç¡€è®¾æ–½æ–¹çš„æ–°å‹æ”¶ç›Šåˆ†é…æ–¹å¼ã€‚" },
  { id: "dogfood",   cat: "cat-biz",  label: "Dogfooding\nin SDLC",      url: "https://stackoverflow.blog/2026/02/24/dogfood-so-nutritious-it-s-building-the-future-of-sdlcs", desc: "å†…éƒ¨ä½¿ç”¨æ¨åŠ¨å·¥å…·æˆç†Ÿï¼Œå½¢æˆé—­ç¯æ”¹è¿›ä¸æ›´å¿«çš„å·¥ç¨‹è¿­ä»£ã€‚" },

  // â”€â”€ Personal â”€â”€
  { id: "nc-agents", cat: "cat-proj", label: "news-collector\nAgents",   url: "https://github.com/Brickea/news-collector/agents?author=Brickea", desc: "åŒ…å«é…ç½®çš„ Agent åˆ—è¡¨ä¸ä»»åŠ¡è®°å½•ï¼Œæ˜¯æŠŠå¤–éƒ¨è¶‹åŠ¿è½åœ°åˆ°å·¥ç¨‹å®è·µçš„ç›´æ¥å…¥å£ã€‚" },
  { id: "brief-run", cat: "cat-proj", label: "News Briefing\nAgent è®°å½•", url: "https://github.com/Brickea/my-oh-my/actions/runs/22449181043/job/65012342888", desc: "æŸ¥çœ‹å…·ä½“è¿è¡Œæ—¥å¿—ä¸ job è¯¦æƒ…ï¼Œè¯„ä¼°æ‘˜è¦è´¨é‡ã€å¤±è´¥ç‡ä¸å»¶è¿Ÿã€‚" },
  { id: "java",      cat: "cat-proj", label: "Java å­¦ä¹ \n2026-02-25",     url: "https://brickea.github.io/daily-program/java/daily/2026-02-25.html", desc: "æ—¥å¸¸å­¦ä¹ ç¬”è®°ä¸ç”Ÿæ€æ›´æ–°ï¼Œå¿«é€Ÿé‡‡ç”¨æ–°ç‰ˆæœ¬æˆ–åº“çš„æ”¯æ’‘ã€‚" },

  // â”€â”€ Deep Dives â”€â”€
  { id: "find-tc",   cat: "cat-deep", label: "GNU find\nå›¾çµå®Œå¤‡æ€§",      url: "https://arxiv.org/abs/2602.20762", desc: "ç†è®ºè¯æ˜ find å‘½ä»¤å¯æ¨¡æ‹Ÿå›¾çµæœºï¼Œæç¤ºã€Œå·¥å…·é“¾å³è¯­è¨€ã€çš„å·¥ç¨‹è‡ªåŠ¨åŒ–æ½œåŠ›ã€‚" },
  { id: "hendrix",   cat: "cat-deep", label: "Jimi Hendrix\nç³»ç»Ÿå·¥ç¨‹",    url: "https://spectrum.ieee.org/jimi-hendrix-systems-engineer", desc: "ä»å·¥ç¨‹è§†è§’è§£æéŸ³é¢‘é“¾è·¯ï¼Œç³»ç»Ÿæ€ç»´å¯è¿ç§»åˆ° Agent è®¾è®¡ã€‚" },
  { id: "trust-gap", cat: "cat-deep", label: "AI ä¿¡ä»»\nå·®è·åˆ†æ",          url: "https://stackoverflow.blog/2026/02/18/closing-the-developer-ai-trust-gap", desc: "å¼€å‘è€…å¯¹ AI çš„ä¿¡ä»»ä¸‹é™ä½†ä½¿ç”¨ä¸Šå‡ï¼Œä¼˜å…ˆè€ƒè™‘å¯è§£é‡Šæ€§ä¸é”™è¯¯æ¢å¤ã€‚" },
];

// Cross-cutting edges (æ¨ªåˆ‡å…³è”)
const CROSS_EDGES = [
  { source: "actions-tc", target: "find-tc",   label: "éƒ½æ˜¯å›¾çµå®Œå¤‡å·¥å…·é“¾" },
  { source: "cowork",     target: "cost-cmp",  label: "Claude ç”Ÿæ€æˆæœ¬å¯¹æ¯”" },
  { source: "mem-arch",   target: "ag-fin",    label: "Finance Agent éœ€è¦è®°å¿†åˆ†å±‚" },
  { source: "nc-agents",  target: "brief-run", label: "åŒä¸€é¡¹ç›®ä½“ç³»" },
  { source: "dogfood",    target: "nc-agents", label: "news-collector å³ dogfood" },
  { source: "clawmoat",   target: "nemo",      label: "å®‰å…¨é˜²æŠ¤äº’è¡¥" },
  { source: "llamafw",    target: "nemo",      label: "å®‰å…¨é˜²æŠ¤äº’è¡¥" },
  { source: "trust-gap",  target: "mem-arch",  label: "å¯è§£é‡Šæ€§ â† è®°å¿†å¯å®¡è®¡" },
  { source: "copilot",    target: "workflow",  label: "CI å‡­è¯ç®¡ç†" },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  BUILD GRAPH DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const nodes = [
  ...CATEGORIES.map(c => ({ ...c, type: c.id === "root" ? "root" : "category" })),
  ...ARTICLES.map(a  => ({ ...a, type: "article", color: null /* inherit from cat */ })),
];

// Assign article colors from their category
const catColorMap = Object.fromEntries(CATEGORIES.map(c => [c.id, c.color]));
nodes.forEach(n => {
  if (n.type === "article") {
    n.color = catColorMap[n.cat] + "bb";  // slightly transparent
    n.size = 12;
  }
});

const links = [];
// root â†’ categories
CATEGORIES.slice(1).forEach(c => links.push({ source: "root", target: c.id, type: "hierarchy" }));
// categories â†’ articles
ARTICLES.forEach(a => links.push({ source: a.cat, target: a.id, type: "hierarchy" }));
// cross edges
CROSS_EDGES.forEach(e => links.push({ ...e, type: "cross" }));

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  D3 SETUP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const svg = d3.select("#graph");
const container = document.getElementById("graph-container");
const tooltip  = document.getElementById("tooltip");

let width  = container.clientWidth;
let height = container.clientHeight;

const g = svg.append("g").attr("class", "scene");

// Zoom
const zoom = d3.zoom()
  .scaleExtent([0.15, 4])
  .on("zoom", e => g.attr("transform", e.transform));
svg.call(zoom);

// Simulation
const simulation = d3.forceSimulation(nodes)
  .force("link",   d3.forceLink(links).id(d => d.id).distance(d =>
    d.source.type === "root" ? 170 : d.source.type === "category" ? 110 : 90
  ).strength(0.6))
  .force("charge", d3.forceManyBody().strength(d =>
    d.type === "root" ? -900 : d.type === "category" ? -500 : -180
  ))
  .force("center", d3.forceCenter(width / 2, height / 2))
  .force("collide", d3.forceCollide().radius(d => d.size + 16).strength(0.7));

// â”€â”€ Links â”€â”€
const link = g.append("g").attr("class", "links")
  .selectAll("line")
  .data(links)
  .join("line")
  .attr("class", d => "link" + (d.type === "cross" ? " cross" : ""))
  .attr("stroke-width", d => d.type === "cross" ? 1.2 : 1.5);

// â”€â”€ Nodes â”€â”€
const node = g.append("g").attr("class", "nodes")
  .selectAll("g")
  .data(nodes)
  .join("g")
  .attr("class", "node")
  .call(d3.drag()
    .on("start", (e, d) => { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
    .on("drag",  (e, d) => { d.fx = e.x; d.fy = e.y; })
    .on("end",   (e, d) => { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; })
  )
  .on("click", (e, d) => {
    if (d.url) { window.open(d.url, "_blank", "noopener"); }
  })
  .on("mouseover", (e, d) => {
    const html = `
      <div class="tt-title">${d.label.replace(/\n/g, " ")}</div>
      <div class="tt-type">${d.type === "category" ? "ä¸»é¢˜èŠ‚ç‚¹" : d.type === "root" ? "æ ¹èŠ‚ç‚¹" : "æ–‡ç«  / èµ„æº"}</div>
      ${d.desc ? `<div class="tt-desc">${d.desc}</div>` : ""}
      ${d.url  ? `<div class="tt-link">ğŸ”— ç‚¹å‡»æ‰“å¼€é“¾æ¥</div>` : ""}
    `;
    tooltip.innerHTML = html;
    tooltip.style.display = "block";
    moveTooltip(e);
  })
  .on("mousemove", moveTooltip)
  .on("mouseout",  () => { tooltip.style.display = "none"; });

// Circles
node.append("circle")
  .attr("r",    d => d.size)
  .attr("fill", d => d.color)
  .attr("stroke", d => d.type === "root" ? "#fff" : "transparent")
  .attr("stroke-width", d => d.type === "root" ? 3 : 0);

// Labels
node.append("text")
  .attr("dy", d => d.size + 12)
  .attr("font-size", d => d.type === "root" ? "10px" : d.type === "category" ? "9px" : "8px")
  .attr("font-weight", d => d.type !== "article" ? "600" : "400")
  .attr("fill", "#c8d0e8")
  .each(function(d) {
    const parts = d.label.split("\n");
    const el = d3.select(this);
    el.text(null);
    parts.forEach((p, i) => {
      el.append("tspan")
        .attr("x", 0)
        .attr("dy", i === 0 ? 0 : "1.2em")
        .text(p);
    });
  });

// â”€â”€ Tick â”€â”€
simulation.on("tick", () => {
  link
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);
  node.attr("transform", d => `translate(${d.x},${d.y})`);
});

// â”€â”€ Legend entries â”€â”€
const legendEl = document.getElementById("legend");
const legendHr = legendEl.querySelector("hr");
CATEGORIES.slice(1).forEach(c => {
  const div = document.createElement("div");
  div.className = "legend-item";
  div.innerHTML = `<span class="legend-dot" style="background:${c.color}"></span>${c.label.replace(/\n/g," ")}`;
  div.addEventListener("click", () => highlightCategory(c.id));
  legendEl.insertBefore(div, legendHr);
});

function highlightCategory(catId) {
  node.select("circle")
    .transition().duration(300)
    .attr("opacity", d => (d.id === catId || d.cat === catId || d.id === "root") ? 1 : 0.18);
  link
    .transition().duration(300)
    .attr("opacity", d => (d.source.id === catId || d.target.id === catId || d.source.cat === catId) ? 1 : 0.08);
}

// Click background resets highlight
svg.on("click.bg", () => {
  node.select("circle").transition().duration(300).attr("opacity", 1);
  link.transition().duration(300).attr("opacity", 1);
});

// â”€â”€ Controls â”€â”€
document.getElementById("btn-reset").addEventListener("click", () => {
  svg.transition().duration(600).call(
    zoom.transform, d3.zoomIdentity.translate(0, 0).scale(1)
  );
});
let frozen = false;
document.getElementById("btn-freeze").addEventListener("click", function() {
  frozen = !frozen;
  frozen ? simulation.stop() : simulation.restart();
  this.textContent = frozen ? "â–¶ æ¢å¤å¸ƒå±€" : "æš‚åœå¸ƒå±€";
});

// â”€â”€ Resize â”€â”€
new ResizeObserver(() => {
  width  = container.clientWidth;
  height = container.clientHeight;
  simulation.force("center", d3.forceCenter(width / 2, height / 2)).alpha(0.1).restart();
}).observe(container);

function moveTooltip(e) {
  const pad = 16;
  let x = e.clientX + pad;
  let y = e.clientY + pad;
  if (x + 290 > window.innerWidth)  x = e.clientX - 290 - pad;
  if (y + 180 > window.innerHeight) y = e.clientY - 180 - pad;
  tooltip.style.left = x + "px";
  tooltip.style.top  = y + "px";
}
</script>
</body>
</html>
